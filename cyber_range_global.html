<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICS CYBER RANGE - Architecture Compl√®te</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg-deep: #020617;
            --hv-color: #ef4444;    /* 225kV */
            --mv-color: #a78bfa;    /* 33kV */
            --gen-color: #fbbf24;   /* 20kV */
            --off-color: #334155;
            --data-eth: #10b981;
            --data-sensor: #f97316;
            --risk: #ff1744;
            --def-blue: #3b82f6;
            --tooltip-bg: rgba(15, 23, 42, 0.98);
            --led-on: #22c55e;
            --led-off: #334155;
            --led-alarm: #ef4444;
        }

        body {
            margin: 0; background-color: var(--bg-deep); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow: hidden;
            background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 40px 40px;
        }

        /* HEADER */
        .hud-header {
            position: fixed; top: 0; width: 100%; height: 60px; background: rgba(2, 6, 23, 0.95);
            border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; z-index: 1000;
        }

        /* CONTAINER GLOBAL */
        .world-container { width: 100%; height: 100vh; overflow: auto; position: relative; }
        
        .canvas-area { 
            width: 2400px; 
            height: 3000px; 
            position: relative; 
            top: 350px; 
            margin-bottom: 200px;
            /* IMPORTANT : Permet de voir le CDC qui est en coordonn√©e n√©gative */
            overflow: visible; 
        }

        /* ZONES */
        .site-zone {
            position: absolute; border: 1px dashed rgba(255,255,255,0.15); border-radius: 12px;
            background: rgba(255,255,255,0.02); pointer-events: none;
        }
        .site-label {
            position: absolute; top: -12px; left: 20px; background: var(--bg-deep); padding: 0 10px;
            font-size: 0.8rem; color: #94a3b8; font-weight: bold; border: 1px solid rgba(255,255,255,0.1);
        }

        /* COMPOSANTS */
        .ot-rack, .phy-comp { position: absolute; box-shadow: 0 4px 15px rgba(0,0,0,0.5); pointer-events: auto; transition: transform 0.2s; }
        .ot-rack:hover, .phy-comp:hover { transform: scale(1.02); z-index: 40; border-color: #fff; }
        
        .ot-rack {
            background: rgba(15, 23, 42, 0.95); border: 1px solid #475569; border-radius: 6px; padding: 8px;
            display: flex; flex-direction: column; gap: 5px; width: 140px; z-index: 20;
        }
        
        .phy-comp { background: #1e293b; border: 2px solid #475569; color: #fff; font-size: 0.7rem; font-weight: bold; display: flex; align-items: center; justify-content: center; z-index: 10; }
        .generator { width: 70px; height: 70px; border-radius: 50%; border-color: var(--gen-color); }
        .trafo { width: 90px; height: 60px; border-radius: 4px; background: linear-gradient(135deg, #334155, #1e293b); }
        .busbar { height: 12px; border-radius: 2px; cursor: help; }
        .breaker { width: 30px; height: 30px; background: #000; border: 2px solid #fff; transition: 0.3s; }
        .breaker.open { background: #330000; border-color: red; }

        /* TOOLTIPS */
        .tooltip-box {
            position: absolute;
            left: 105%; top: 0;
            width: 200px;
            background: var(--tooltip-bg);
            border: 1px solid #64748b;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            color: #e2e8f0;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.8);
        }
        .tooltip-box h4 { margin: 0 0 5px 0; color: #fff; font-size: 0.8rem; border-bottom: 1px solid #333; padding-bottom: 3px; }
        .tooltip-warning h4 { color: var(--risk); border-color: var(--risk); }
        *:hover > .tooltip-box { opacity: 1; }

        /* STYLE IHM */
        .hmi-panel {
            display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 5px; border-top: 1px solid #333; padding-top: 5px;
        }
        .ctrl-btn {
            background: #334155; border: 1px solid #475569; color: white; font-size: 0.6rem; padding: 4px; cursor: pointer; border-radius: 3px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .ctrl-btn:hover { background: #475569; }
        .ctrl-btn:active { transform: translateY(1px); }
        .led { width: 8px; height: 8px; border-radius: 50%; background: var(--led-off); box-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .led.on { background: var(--led-on); box-shadow: 0 0 8px var(--led-on); }
        .led.off { background: var(--risk); }
        .led.alarm { animation: blink 0.5s infinite; background: var(--led-alarm); }
        @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

        /* SVG */
        /* CORRECTION ICI : overflow visible pour voir les lignes qui montent vers le CDC */
        svg.cabling { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 1; 
            overflow: visible; 
        }

        .wire-pwr { fill: none; stroke-width: 4; stroke-linecap: round; transition: stroke 0.5s; }
        .wire-eth { fill: none; stroke: var(--data-eth); stroke-width: 2; opacity: 0.7; }
        .wire-sensor { fill: none; stroke: var(--data-sensor); stroke-width: 1.5; stroke-dasharray: 4; opacity: 0.8; }
        .pwr-flow { fill: none; stroke: rgba(255,255,255,0.8); stroke-width: 2; stroke-dasharray: 10 20; opacity: 0; transition: opacity 0.5s; pointer-events: none;}
        .pwr-flow.active { opacity: 1; animation: flow-pwr 1s linear infinite; }
        @keyframes flow-pwr { to { stroke-dashoffset: -30; } }
        .pylon { fill: none; stroke: #64748b; stroke-width: 2; }
        @keyframes flow { to { stroke-dashoffset: -20; } }
        .flow-anim { stroke-dasharray: 6; animation: flow 0.8s linear infinite; }
        
        /* VULNERABILITIES */
        .vuln-star {
            position: absolute; width: 24px; height: 24px; color: var(--risk); font-size: 1.5rem; 
            cursor: pointer; z-index: 100; filter: drop-shadow(0 0 5px red); 
            animation: pulse 2s infinite; display: flex; justify-content: center; align-items: center; pointer-events: auto;
        }
        .vuln-star:hover { transform: scale(1.3); }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.7;} }

        canvas { background: #000; border: 1px solid #333; width: 100%; height: 40px; border-radius: 3px; }
        .metrics { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--data-eth); }
        .rack-head { font-size: 0.65rem; color: #94a3b8; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 2px; margin-bottom: 2px; }

        /* --- CSS POUR LE CDC --- */
        .sec-node {
            position: absolute;
            width: 100px;
            background: rgba(2, 6, 23, 0.95);
            border: 1px solid var(--def-blue);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.15);
            z-index: 60;
        }
        .sec-node h5 { margin:0; color:var(--def-blue); font-size:0.7rem; }
        .sec-node span { font-size:0.6rem; color:#94a3b8; }
        
        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: #334155; }
        .status-dot.active { background: #22c55e; box-shadow: 0 0 5px #22c55e; animation: blink-slow 2s infinite; }
        @keyframes blink-slow { 0%,100%{opacity:1;} 50%{opacity:0.5;} }

        /* C√¢bles de logs (Syslog/SNMP) */
        .wire-log {
            fill: none;
            stroke: var(--def-blue);
            stroke-width: 2; /* Ligne plus √©paisse pour visibilit√© */
            stroke-dasharray: 4;
            opacity: 0.8;
            animation: flow-log 1s linear infinite;
        }
        @keyframes flow-log { to { stroke-dashoffset: -8; } }

        /* L√©gende */
        .legend-hud {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 220px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 15px;
            z-index: 2000;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .legend-title { font-size: 0.75rem; font-weight: 700; color: #94a3b8; text-transform: uppercase; margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 5px; }
        .leg-item { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; font-size: 0.7rem; color: #cbd5e1; }
        .leg-icon { width: 14px; height: 14px; display: flex; align-items: center; justify-content: center; border-radius: 3px; font-weight: bold; }

    </style>
</head>
<body>

    <div class="hud-header">
        <div style="font-weight:700;">üõ°Ô∏è ICS CYBER RANGE <span style="font-weight:400; font-size:0.8em; color:#64748b;">// FULL THREAT MAP & DEFENSE</span></div>
        <button onclick="location.reload()" style="background:#334155; border:none; color:white; padding:5px 12px; border-radius:4px; cursor:pointer;">Reset</button>
    </div>

    <div class="legend-hud">
        <div class="legend-title">L√©gende Carte</div>
        <div class="leg-item"><div class="leg-icon" style="color:var(--risk);">‚òÖ</div> Vuln√©rabilit√© (Cliquable)</div>
        <div class="leg-item"><div class="leg-icon" style="background:var(--hv-color);"></div> Ligne 225kV (Haute Tension)</div>
        <div class="leg-item"><div class="leg-icon" style="background:var(--mv-color);"></div> Ligne 33kV (Distribution)</div>
        <div class="leg-item"><div class="leg-icon" style="background:var(--data-eth);"></div> R√©seau Ethernet/SCADA</div>
        <div class="leg-item"><div class="leg-icon" style="border:1px dashed var(--def-blue);"></div> Flux Logs/S√©curit√©</div>
        <div class="leg-item"><div class="leg-icon" style="background:#000; border:1px solid #fff;"></div> Disjoncteur (Ouvrable)</div>
    </div>

    <div class="world-container">
        <div class="canvas-area">
            
            <svg class="cabling">
                <defs>
                    <marker id="arrow-eth" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"><path d="M0,0 L0,6 L6,3 z" fill="#10b981" /></marker>
                    <marker id="arrow-sensor" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"><path d="M0,0 L0,6 L6,3 z" fill="#f97316" /></marker>
                    <marker id="arrow-log" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"><path d="M0,0 L0,6 L6,3 z" fill="#3b82f6" /></marker>
                </defs>

                <path d="M 185 750 L 230 750" class="wire-pwr" style="stroke:var(--gen-color)"></path> 
                <path d="M 330 750 L 360 750" class="wire-pwr" style="stroke:var(--gen-color)"></path>
                <path d="M 450 750 L 480 750" class="wire-pwr" style="stroke:var(--hv-color)"></path>
                <path id="hv-line" d="M 630 750 L 1630 750" class="wire-pwr" style="stroke:var(--hv-color)"></path>
                <path id="thies-in" d="M 1730 750 L 1760 750" class="wire-pwr" style="stroke:var(--hv-color)"></path>
                <path id="thies-mid" d="M 1850 750 L 1880 750" class="wire-pwr" style="stroke:var(--mv-color)"></path>
                <path id="f1-w" d="M 1915 756 L 1915 780" class="wire-pwr" style="stroke:var(--mv-color); stroke-width:2"></path>
                <path id="f2-w" d="M 1965 756 L 1965 780" class="wire-pwr" style="stroke:var(--mv-color); stroke-width:2"></path>
                <path id="f3-w" d="M 2015 756 L 2015 780" class="wire-pwr" style="stroke:var(--mv-color); stroke-width:2"></path>

                <path id="flow-dakar" d="M 185 750 L 480 750" class="pwr-flow active"></path>
                <path id="flow-hv" d="M 630 750 L 1630 750" class="pwr-flow active"></path>
                <path id="flow-thies-in" d="M 1730 750 L 1760 750" class="pwr-flow active"></path>
                <path id="flow-thies-out" d="M 1850 750 L 2015 750" class="pwr-flow active"></path>

                <g transform="translate(850, 750)">
                    <path d="M -20,0 L 0,-80 L 20,0 M -15,-50 L 15,-50 M -10,-25 L 10,-25" class="pylon" />
                </g>
                <g transform="translate(1410, 750)">
                    <path d="M -20,0 L 0,-80 L 20,0 M -15,-50 L 15,-50 M -10,-25 L 10,-25" class="pylon" />
                </g>

                <path d="M 405 720 L 405 660 L 350 660 L 350 610" class="wire-sensor flow-anim" marker-end="url(#arrow-sensor)"></path>
                <path d="M 1805 720 L 1805 610" class="wire-sensor flow-anim" marker-end="url(#arrow-sensor)"></path>
                
                <path d="M 350 530 L 350 470" class="wire-eth flow-anim" marker-end="url(#arrow-eth)"></path>
                <path d="M 300 445 L 240 445" class="wire-eth flow-anim" marker-end="url(#arrow-eth)" style="animation-direction:reverse"></path>
                <path d="M 400 445 L 460 445" class="wire-eth flow-anim" marker-end="url(#arrow-eth)" style="animation-direction:reverse"></path>

                <path d="M 1805 530 L 1805 470" class="wire-eth flow-anim" marker-end="url(#arrow-eth)"></path>
                <path d="M 1855 445 L 1910 445" class="wire-eth flow-anim" marker-end="url(#arrow-eth)" style="animation-direction:reverse"></path>
                <path d="M 1755 445 L 1690 445" class="wire-eth flow-anim" marker-end="url(#arrow-eth)" style="animation-direction:reverse"></path>

                <path d="M 350 420 L 350 220 L 1100 220 L 1100 240" class="wire-eth flow-anim" style="stroke-dasharray:8; opacity:0.3;"></path>
                <path d="M 1805 420 L 1805 220 L 1100 220" class="wire-eth flow-anim" style="stroke-dasharray:8; opacity:0.3;"></path>

                <path d="M 1050 265 L 980 265 L 980 135" class="wire-eth" style="opacity:0.4"></path>
                <path d="M 1150 265 L 1220 265 L 1220 135" class="wire-eth" style="opacity:0.4"></path>
                <path d="M 1050 290 L 980 290 L 980 340" class="wire-eth" style="opacity:0.4"></path>
                <path d="M 1150 290 L 1220 290 L 1220 340" class="wire-eth" style="opacity:0.4"></path>
                
                <path d="M 1040 275 L 820 275 L 820 230" class="wire-eth" style="opacity:0.4"></path>
                <path d="M 1160 275 L 1380 275 L 1380 230" class="wire-eth" style="opacity:0.4"></path>

                <path d="M 1100 250 L 1100 50 L 1110 50 L 1110 -95" class="wire-log" style="stroke-width:3;" marker-end="url(#arrow-log)"></path>

                <path d="M 900 -145 L 900 -105 L 1050 -105" class="wire-log" style="stroke-width:3; stroke: #38bdf8;"></path>
                
                <path d="M 1300 -145 L 1300 -105 L 1170 -105" class="wire-log" style="stroke-width:3; stroke: #f472b6;"></path>

                <path d="M 1110 -135 L 1110 -200" class="wire-log" style="stroke-width:3; animation-duration:0.5s;" marker-end="url(#arrow-log)"></path>
            </svg>

            <div class="site-zone" style="top:-280px; left:750px; width:700px; height:250px; border-color:var(--def-blue);">
                <div class="site-label" style="color:var(--def-blue); border-color:var(--def-blue);">CYBER DEFENSE CENTER (SOC)</div>

                <div class="sec-node" style="top:150px; left:300px; width:120px; border-width:2px;">
                    <h5>SIEM (SPLUNK)</h5>
                    <span>Logs Collection</span>
                    <div class="status-dot active" style="margin:5px auto;"></div>
                </div>

                <div class="sec-node" style="top:80px; left:100px;">
                    <h5>NEXT-GEN FW</h5>
                    <span>Segmentation</span>
                    <div class="status-dot active" style="margin:5px auto;"></div>
                </div>

                <div class="sec-node" style="top:80px; left:500px;">
                    <h5>IDS / NIDS</h5>
                    <span>Traffic Analysis</span>
                    <div class="status-dot active" style="margin:5px auto; background:#f472b6; box-shadow:0 0 5px #f472b6;"></div>
                </div>

                <div class="sec-node" style="top:20px; left:310px;">
                    <h5>THREAT INTEL</h5>
                    <span>Feed & EDR</span>
                    <div class="status-dot active" style="margin:5px auto;"></div>
                </div>
            </div>

            <div class="site-zone" style="top:50px; left:750px; width:700px; height:420px;">
                <div class="site-label">DCS (DISTRIBUTED CONTROL SYSTEM)</div>
                
                <div class="ot-rack" style="top:40px; left:160px;">
                    <div class="rack-head">SCADA GLOBAL</div>
                    <div id="soc-screen" class="metrics" style="background:#000; padding:5px; text-align:center;">SYSTEM OK</div>
                    <div class="tooltip-box"><h4>SCADA Principal</h4>Cerveau du r√©seau. Coordonne Dakar et Thi√®s.</div>
                </div>
                <div class="vuln-star" style="top:30px; left:310px;" onclick="attack('scada')">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>Injection SQL/CMD</h4>Prise de contr√¥le du serveur SCADA via l'interface web.</div>
                </div>

                <div class="ot-rack" style="top:40px; left:400px;">
                    <div class="rack-head">HISTORIAN</div>
                    <div class="metrics">OSISOFT PI<br>ARCHIVE: ON</div>
                    <div class="tooltip-box"><h4>Serveur d'Historisation</h4>Base de donn√©es temporelle des m√©triques.</div>
                </div>
                <div class="vuln-star" style="top:30px; left:550px;">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>Falsification de Donn√©es</h4>Modification des logs pour masquer une attaque.</div>
                </div>

                <div class="ot-rack" style="top:140px; left:20px;">
                    <div class="rack-head">DOMAIN CTRL (AD)</div>
                    <div class="metrics">WIN SVR 2019<br>KERBEROS: UP</div>
                    <div class="tooltip-box"><h4>Active Directory</h4>Gestion des identit√©s et des acc√®s utilisateurs.</div>
                </div>
                <div class="vuln-star" style="top:130px; left:170px;">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>Golden Ticket</h4>Vol d'identifiants administrateur (Mimikatz).</div>
                </div>

                <div class="ot-rack" style="top:140px; left:580px;">
                    <div class="rack-head">JUMP HOST</div>
                    <div class="metrics">RDP GW<br>MFA: OFF</div>
                    <div class="tooltip-box"><h4>Bastion de Maintenance</h4>Point d'entr√©e unique pour la t√©l√©maintenance.</div>
                </div>
                <div class="vuln-star" style="top:130px; left:550px;">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>BlueKeep / Brute Force</h4>Exploitation de vuln√©rabilit√©s RDP pour entrer dans le r√©seau OT.</div>
                </div>

                <div class="ot-rack" style="top:200px; left:290px; width:120px; height:50px; justify-content:center; align-items:center; border: 2px solid #64748b;">
                    <span style="font-size:0.7rem; color:#fff;">DCS BACKBONE</span>
                    <div class="tooltip-box"><h4>Core Switch</h4>C≈ìur de r√©seau commut√© haute disponibilit√©.</div>
                </div>
                <div class="vuln-star" style="top:230px; left:340px; color:orange;">‚òÖ
                    <div class="tooltip-box tooltip-warning" style="top:20px;"><h4>Man-in-the-Middle</h4>Interception du trafic entre les sites et le SCADA.</div>
                </div>

                <div class="ot-rack" style="top:300px; left:160px;">
                    <div class="rack-head">EWS (ENGINEERING)</div>
                    <div class="metrics">TIA PORTAL<br>ACCESS: ADMIN</div>
                    <div class="tooltip-box"><h4>Station Ing√©nierie</h4>Programmation des automates. Le joyau de la couronne.</div>
                </div>
                <div class="vuln-star" style="top:290px; left:130px;">‚òÖ
                    <div class="tooltip-box tooltip-warning" style="right:100%; left:auto;"><h4>Logic Injection</h4>Modification malveillante du code automate (ex: Stuxnet).</div>
                </div>

                <div class="ot-rack" style="top:300px; left:400px; height:auto;">
                    <div class="rack-head">GLOBAL HMI (OWS)</div>
                    <canvas id="chart-soc"></canvas>
                    <div class="tooltip-box"><h4>Poste Op√©rateur Global</h4>Supervision temps r√©el de l'ensemble du pays.</div>
                </div>
                 <div class="vuln-star" style="top:290px; left:550px;">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>Ransomware</h4>Chiffrement du poste op√©rateur (BlackEnergy).</div>
                </div>
            </div>

            <div class="site-zone" style="top:250px; left:100px; width:600px; height:600px;">
                <div class="site-label">DAKAR (PRODUCTION)</div>

                <div class="ot-rack" style="top:155px; left:0px; width:140px;"> 
                    <div class="rack-head">SCADA SRV</div>
                    <div class="metrics">DB: OK</div>
                    <div class="tooltip-box"><h4>SCADA Local Dakar</h4>Contr√¥le production.</div>
                </div>

                <div class="ot-rack" style="top:155px; left:360px; width:160px; height:auto;"> 
                    <div class="rack-head">IHM OPERATEUR</div>
                    <canvas id="chart-dakar"></canvas>
                    <div class="hmi-panel">
                        <button class="ctrl-btn" onclick="toggleSwitch('dakar_cb')">
                            DJ-01 <div id="led-dakar-cb" class="led on"></div>
                        </button>
                        <button class="ctrl-btn" onclick="toggleSwitch('dakar_sect')">
                            SECT-01 <div id="led-dakar-sect" class="led on"></div>
                        </button>
                        <div style="grid-column: span 2; display:flex; justify-content:center; margin-top:5px;">
                            <div id="alarm-dakar" class="metrics" style="color:#333; font-weight:bold;">ALARM</div>
                        </div>
                    </div>
                    <div class="tooltip-box"><h4>Poste Op√©rateur</h4>HMI Local. Permet la commande des disjoncteurs.</div>
                </div>

                <div class="ot-rack" style="top:170px; left:200px; width:100px; height:50px; justify-content:center; align-items:center;">
                    <span style="font-size:0.6rem;">SWITCH/ROUTEUR</span>
                    <div class="tooltip-box"><h4>Switch Industriel</h4>Zone Production.</div>
                </div>

                <div class="ot-rack" style="top:280px; left:180px;">
                    <div class="rack-head">PLC SIEMENS</div>
                    <div class="metrics">RUN: OK<br>IP: 10.0.1.5</div>
                    <div class="tooltip-box"><h4>API Turbine</h4>R√©gulation vitesse.</div>
                </div>
                <div class="vuln-star" style="top:290px; left:330px;" onclick="attack('plc')">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>Stop CPU / Rogue Station</h4>Arr√™t forc√© de l'automate via le protocole S7.</div>
                </div>

                <div class="phy-comp generator" style="top:465px; left:50px;">GEN
                    <div class="tooltip-box"><h4>Alternateur</h4>50MW.</div>
                </div> 
                
                <div class="phy-comp busbar" style="top:494px; left:130px; width:100px; background:var(--gen-color);">
                    <div class="tooltip-box"><h4>Jeu de Barres 20kV</h4>Tension nominale sortie alternateur.</div>
                </div>
                
                <div class="phy-comp trafo" style="top:470px; left:260px;">TR-01
                    <div class="tooltip-box"><h4>Transformateur</h4>20kV/225kV.</div>
                </div>
                
                <div class="phy-comp busbar" style="top:494px; left:380px; width:150px; background:var(--hv-color);">
                    <div class="tooltip-box"><h4>Jeu de Barres 225kV</h4>Poste d'√©vacuation HTB.</div>
                </div>
            </div>

            <div class="site-zone" style="top:250px; left:1550px; width:600px; height:600px;">
                <div class="site-label">THIES (DISTRIBUTION)</div>

                <div class="ot-rack" style="top:155px; left:0px; width:140px;"> 
                    <div class="rack-head">SCADA LOCAL</div>
                    <div class="metrics">MODBUS: MASTER<br>DB: OK</div>
                    <div class="tooltip-box"><h4>SCADA Local Thi√®s</h4>Supervision Distribution.</div>
                </div>
                 <div class="vuln-star" style="top:145px; left:150px;">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>Buffer Overflow</h4>Exploitation vuln√©rabilit√© logicielle SCADA.</div>
                </div>

                <div class="ot-rack" style="top:155px; left:360px; width:160px; height:auto;"> 
                    <div class="rack-head">IHM THIES</div>
                    <canvas id="chart-thies"></canvas>
                    <div class="hmi-panel">
                        <button class="ctrl-btn" onclick="toggleSwitch('thies_cb')">
                            DJ-ARR <div id="led-thies-cb" class="led on"></div>
                        </button>
                        <button class="ctrl-btn" onclick="toggleSwitch('thies_sect')">
                            SECT-IN <div id="led-thies-sect" class="led on"></div>
                        </button>
                         <div style="grid-column: span 2; display:flex; justify-content:center; margin-top:5px;">
                            <div id="alarm-thies" class="metrics" style="color:#333; font-weight:bold;">ALARM</div>
                        </div>
                    </div>
                    <div class="tooltip-box"><h4>HMI Distribution</h4>Vue Disjoncteurs.</div>
                </div>

                <div class="ot-rack" style="top:170px; left:205px; width:100px; height:50px; justify-content:center; align-items:center;">
                    <span style="font-size:0.6rem;">SWITCH/ROUTEUR</span>
                    <div class="tooltip-box"><h4>Switch Zone</h4>VLAN Modbus.</div>
                </div>

                <div class="ot-rack" style="top:280px; left:185px;">
                    <div class="rack-head">PLC SCHNEIDER</div>
                    <div id="rtu-status" class="metrics">MODBUS: OK</div>
                    <div class="tooltip-box"><h4>M580</h4>Contr√¥le Postes.</div>
                </div>
                <div class="vuln-star" style="top:290px; left:150px;" onclick="attack('rtu')">‚òÖ
                    <div class="tooltip-box tooltip-warning" style="right:100%; left:auto;"><h4>Modbus Poisoning</h4>Injection de commandes d'ouverture de disjoncteur.</div>
                </div>

                <div class="phy-comp busbar" id="thies-hv" style="top:494px; left:50px; width:130px; background:var(--hv-color);">
                    <div class="tooltip-box"><h4>Jeu de Barres 225kV</h4>Arriv√©e Ligne Interconnexion.</div>
                </div>
                <div class="phy-comp trafo" style="top:470px; left:210px;">TR-02
                    <div class="tooltip-box"><h4>Transformateur</h4>225kV/33kV.</div>
                </div>
                <div class="phy-comp busbar" id="thies-mv" style="top:494px; left:330px; width:150px; background:var(--mv-color);">
                    <div class="tooltip-box"><h4>Jeu de Barres 33kV</h4>Distribution Moyenne Tension.</div>
                </div>

                <div class="phy-comp breaker" id="bk1" style="top:530px; left:350px;">
                    <div class="tooltip-box" style="left:auto; right:120%;"><h4>D1</h4>H√¥pital.</div>
                </div>
                <div class="phy-comp breaker" id="bk2" style="top:530px; left:400px;">
                    <div class="tooltip-box" style="left:auto; right:120%;"><h4>D2</h4>Industrie.</div>
                </div>
                <div class="phy-comp breaker" id="bk3" style="top:530px; left:450px;">
                    <div class="tooltip-box" style="left:auto; right:120%;"><h4>D3</h4>Ville.</div>
                </div>
            </div>

            <div style="position:absolute; top:700px; left:1130px; width:40px; height:100px;">
                <div class="vuln-star" style="top:40px; left:0px; color:orange;" onclick="attack('line')">‚òÖ
                    <div class="tooltip-box tooltip-warning"><h4>Sabotage Physique</h4>Destruction de pyl√¥ne ou coupure de fibre optique.</div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const state = { 
            dakar_v:20, 
            line_cut:false, 
            rtu_hacked:false, 
            scada_hacked:false, 
            plc_flood:false,
            dakar_cb: true,
            dakar_sect: true,
            thies_cb: true,
            thies_sect: true
        };
        
        window.toggleSwitch = (id) => {
            state[id] = !state[id];
            updateHMI();
        };

        function updateHMI() {
            document.getElementById('led-dakar-cb').className = state.dakar_cb ? 'led on' : 'led off';
            document.getElementById('led-dakar-sect').className = state.dakar_sect ? 'led on' : 'led off';
            document.getElementById('led-thies-cb').className = state.thies_cb ? 'led on' : 'led off';
            document.getElementById('led-thies-sect').className = state.thies_sect ? 'led on' : 'led off';

            const dakar_out = state.dakar_cb && state.dakar_sect && !state.plc_flood;
            const line_intact = !state.line_cut;
            const thies_in = state.thies_cb && state.thies_sect;

            document.getElementById('flow-dakar').style.opacity = dakar_out ? 1 : 0;
            document.getElementById('flow-hv').style.opacity = (dakar_out && line_intact) ? 1 : 0;
            document.getElementById('flow-thies-in').style.opacity = (dakar_out && line_intact && thies_in) ? 1 : 0;
            document.getElementById('flow-thies-out').style.opacity = (dakar_out && line_intact && thies_in) ? 1 : 0;

            const alarmD = document.getElementById('alarm-dakar');
            const alarmT = document.getElementById('alarm-thies');
            
            if(state.plc_flood || !state.dakar_cb) { alarmD.style.color = '#ff1744'; alarmD.classList.add('blink'); } 
            else { alarmD.style.color = '#333'; alarmD.classList.remove('blink'); }

            if(state.rtu_hacked || !state.thies_cb) { alarmT.style.color = '#ff1744'; alarmT.classList.add('blink'); } 
            else { alarmT.style.color = '#333'; alarmT.classList.remove('blink'); }
        }

        const createChart = (id, color) => {
            const ctx = document.getElementById(id).getContext('2d');
            const data = new Array(50).fill(0.5);
            return { ctx, data, color };
        };
        const charts = {
            dakar: createChart('chart-dakar', '#fbbf24'),
            thies: createChart('chart-thies', '#a78bfa'),
            soc: createChart('chart-soc', '#10b981')
        };

        const drawLine = (c, val, dead) => {
            const {ctx, data, color} = c;
            const w=ctx.canvas.width, h=ctx.canvas.height;
            data.push(val); data.shift();
            ctx.clearRect(0,0,w,h);
            ctx.beginPath(); ctx.strokeStyle = dead?'#333':color; ctx.lineWidth=2;
            data.forEach((v,i) => {
                const x = (i/(data.length-1))*w;
                const y = h - (v*h);
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            });
            ctx.stroke();
        };

        setInterval(() => {
            const t = Date.now()/500;
            updateHMI(); 
            
            let sigD = 0.5 + Math.sin(t)*0.3;
            if(!state.dakar_cb || !state.dakar_sect) sigD = 0;
            if(state.plc_flood) sigD += (Math.random()-0.5)*0.8;
            
            let sigT = sigD * 0.9;
            let deadT = false;
            if(state.line_cut) { sigT=0; deadT=true; }
            if(!state.thies_cb || !state.thies_sect) sigT = 0; 
            if(state.rtu_hacked && !state.line_cut && sigT > 0) sigT = 0.1;

            let sigS = 0.2 + Math.random()*0.1;
            if(state.plc_flood || state.scada_hacked) sigS = 0.9;

            drawLine(charts.dakar, sigD, sigD === 0);
            drawLine(charts.thies, sigT, (deadT || sigT === 0));
            
            const cs = charts.soc.ctx;
            cs.clearRect(0,0,100,50);
            cs.fillStyle = (state.scada_hacked||state.plc_flood)?'#ef4444':'#10b981';
            cs.fillRect(0, 50-(sigS*50), 300, sigS*50);

        }, 100);

        window.attack = (type) => {
            if(type==='line') {
                state.line_cut = !state.line_cut;
                const c = state.line_cut ? '#334155' : '#ef4444';
                const m = state.line_cut ? '#334155' : '#a78bfa';
                document.getElementById('hv-line').style.stroke = c;
                document.getElementById('thies-in').style.stroke = c;
                document.getElementById('thies-hv').style.background = c;
                document.getElementById('thies-mid').style.stroke = m;
                document.getElementById('thies-mv').style.background = m;
                ['f1-w','f2-w','f3-w'].forEach(id=>document.getElementById(id).style.stroke=m);
            }
            if(type==='rtu') {
                state.rtu_hacked = !state.rtu_hacked;
                const txt = document.getElementById('rtu-status');
                ['bk1','bk2','bk3'].forEach(id=>{
                    const el = document.getElementById(id);
                    if(state.rtu_hacked) el.classList.add('open'); else el.classList.remove('open');
                });
                txt.innerHTML = state.rtu_hacked ? "<span style='color:red'>ERR: COILS 0x00</span>" : "MODBUS: OK";
            }
            if(type==='scada') {
                state.scada_hacked = !state.scada_hacked;
                const s = document.getElementById('soc-screen');
                if(state.scada_hacked) { s.style.background='red'; s.style.color='white'; s.innerText="HACKED"; }
                else { s.style.background='black'; s.style.color='#10b981'; s.innerText="SYSTEM OK"; }
            }
            if(type==='plc') state.plc_flood = !state.plc_flood;
        };
    </script>
</body>
</html>